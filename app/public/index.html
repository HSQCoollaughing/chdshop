<!DOCTYPE html>
<html ng-app="shop">
<head>
<meta charset="UTF-8">
<title>商城</title>
<link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.css">
<style>
body{margin-top:70px;}
</style>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" ng-controller="NavBarCtrl">
    <div class="navbar-header">
        <a href="#" class="navbar-brand">珠峰商城</a>
    </div>
    <ul class="nav navbar-nav">
        <li ng-show="user"><a href="#/home">首页</a></li>
        <li ng-show="!user"><a href="#/user/reg">注册</a></li>
        <li ng-show="!user"><a href="#/user/login">登录</a></li>
    </ul>
    <ul class="nav navbar-nav navbar-right" ng-show="user">
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">
                <img ng-src="{{user.avatar}}" alt="{{user.username}}">{{user.username}}<span class="caret"></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-left">
                <li><a href="#" ng-click="logout()">退出</a></li>
            </ul>
        </li>
    </ul>
</nav>
<div class="row" ng-view></div>
</body>
</html>
<script src="lib/jquery/dist/jquery.js"></script>
<script src="lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="lib/angular/angular.js"></script>
<script src="lib/angular-route/angular-route.js"></script>
<script>
    var app = angular.module('shop',['ngRoute']);

    app.config(function ($routeProvider,$locationProvider) {
        $routeProvider.when('/',{
            templateUrl:'pages/home.html',
            controller:'HomeCtrl'
        }).when('/home',{
            templateUrl:'pages/home.html',
            controller:'HomeCtrl'
        }).when('/user/reg',{
            templateUrl:'pages/user/reg.html',
            controller:'RegCtrl'
        }).when('/user/login',{
            templateUrl:'pages/user/login.html',
            controller:'LogCtrl'
        }).otherwise('/');
    });

    app.controller('HomeCtrl',function($scope){
        $scope.title='珠峰商城';
    });

    app.controller('NavBarCtrl',function($scope,$http,$location){
        $scope.title='导航';
        $scope.logout = function () {
            $http({
                url:'/user/logout',
                method:'POST'

            }).success(function (data){
                $location.path('/user/login');
            }).error(function (err) {
                $location.path('/user/login');
            })
        }
    });

    app.controller('RegCtrl',function($scope,$http,$location){
        $scope.title='注册';
        $scope.save = function () {
            $http({
                url:'/user/reg',
                method:'POST',
                data:$scope.user
            }).success(function (data){
                $location.path('/user/login');
            }).error(function (err) {
                console.log(err)
                $location.path('/user/reg');
            })
        }
    });

    app.controller('LogCtrl',function($rootScope,$scope,$http,$location){
        $scope.title='登录';
        $scope.save = function () {
            $http({
                url:'/user/login',
                method:'POST',
                data:$scope.user
            }).success(function (data){
                //$rootScope.user = data;
                $location.path('/home');
            }).error(function (err) {
                console.log(err)
            })
        }
    });
</script>